### ...

```zsh
ssh <user_name>@<remote_host> -p <port>
```
	Порт можно не указывать, если он не отличается от стандартного 22.


Выполнить комманду на удаленном сервере и сразу покинуть его:
```zsh
ssh <user_name>@<remote_host> <command>
```
	-t - если приложения хотят иметь управляющий терминал.


Если нужно запустить сервер из определенной директории:
```zsh
ssh <user_name>@<remote_host> -t 'cd /path/to/particular/directory; exec $SHELL'
```
	Вместо ; - &&.
	Вместо exec $SHELL - exec bash или просто bash.


1. Чтобы постоянно не указывать эту определенную директорию, нужно:
```zsh
vim ~/.bash_profile
```
	Вместо .bash_profile - .profile, .bashrc.

2. Вставить в конец `cd /path/to/particular/directory`, сохранить и выйти.

3. Запустить изменный файл:
```zsh
source ~/.bash_profile
```

4. Теперь можно зайти на сервер, её не указывая:
```zsh
ssh <user_name>@<remote_host>
```

### SCP

```zsh
scp /path/to/local/file <user_name>@<remote_host>:/path/to/remote/directory
```

```zsh
scp -r path/to/local/directory/with/nested/one(s) <user_name>@<remote_host>:/path/to/remote/directory
```


```zsh
scp <user_name>@<remote_host>:/path/to/remote/file ~/Desktop
```

```zsh
scp -r <user_name>@<remote_host>:/path/to/remote/directory/with/nested/one(s) ~/Desktop
```


Проброс STDIN/OUT

```zsh
ssh <user_name>@<remote_host> <command> > /path/to/local/file
```

```zsh
<command> | scp - <user_name>@<remote_host>:/path/to/remote/file
```

```zsh
<command> | ssh <user_name_1>@<remote_host_1> 'scp - <user_name_2>@<remote_host_2>:/path/to/remote/file'
```

### FINGERPRINT

При первом подключении появится сообщение:

```
The authenticity of host '52.307.149.244 (52.307.149.244)' can't be established.
ECDSA key fingerprint is fd:fd:d4:f9:77:fe:73:84:e1:55:00:ad:d6:6d:22:fe.
Are you sure you want to continue connecting (yes/no)? yes
```

Введите `yes` в первый раз.

Это нужно для повышения безопасности. При настройке SSH-сервера создается уникальная комбинация символов — `fingerprint (отпечатки пальцев)`. Ваш компьютер запоминает эту комбинацию и сверяет ее при каждом новом соединении. Представьте, что кто-то внёс изменения в систему, например:

- Переустановил SSH-сервер
- Переустановил всю операционную систему
- Заменил удаленный компьютер, сохранив его адрес

Даже в этом случае вы заметите изменения, потому что `fingerprint` тоже изменится.

Если `fingerprint` не меняется, то такое сообщение не будет появляться.

### ГЕНЕРАЦИЯ КЛЮЧЕЙ

Для удобного подключения по SSH (и многим другим сервисам) без ввода пароля можно использовать ключи.

Нужно создать пару ключей: **приватный** (закрытый) ключ и **публичный**(открытый) ключ. Приватный ключ нужно хранить и никогда никому не показывать. Публичный ключ можно показывать всем и распространять свободно.

Эти _ключи связаны друг с другом_ таким образом, что зашифровав информацию одним ключом, расшифровать ее можно только другим. Например, если ваш друг зашифрует письмо вашим публичным ключом, то прочитать его сможете только вы, потому что для этого нужен ваш приватный ключ. И наоборот: если вы зашифруете что-то своим приватным ключом, то расшифровать его можно только вашим публичным ключом. Так как публичный ключ доступен всем, любой может расшифровать это сообщение. Но он может быть уверен, что сообщение пришло именно от вас. В этом заключается идея цифровой подписи.

```zsh
ssh-keygen 
```
	-t - вариант шифрования, например rsa.
	-b - количество бит, длина ключа, например 4096.
	-С - задать последнее поле публичного ключа в виде user@machine.
	-f - задать имя файла, т.е. id_rsa_<new_name>

В ключе последнее поле — `user@machine`. Оно не имеет никакого отношения к авторизации и служит только для удобства определения, где чей ключ. Это поле может быть поменяно (или даже удалено) без нарушения структуры ключа.

Cменить passphrase на ключ:
```zsh
ssh-keygen -p
```

Удалить известный ключ сервера:
```zsh
ssh-keygen -R <remote_host>
```
	Затем его можно найти на сервере в /etc/ssh/ssh_host_rsa_key.pub

### ЗАГРУЗКА ПУБЛИЧНОГО КЛЮЧА НА СЕРВЕР

Если известен пароль от сервера:
```zsh
ssh-copy-id <user_name>@<remote_host>
```

```zsh
ssh-copy-id -i ~/.ssh/id_rsa.pub <user_name>@<remote_host>
```
	На случай, если нужно прописать путь до личного публичного ключа.

```zsh
ssh-copy-id '<user_name>@<remote_host> -p <port>'
```
	На случай, если порт не стандартный.

(Как один из вариантов) Если нет, то в ручную скопировать из `~/.ssh/id_rsa.pub` или:
```zsh
cat ~/.ssh/id_rsa.pub | pbcopy
```
и вставить в `~/.ssh/authorized_keys`.

### ЧТОБЫ ОТКЛЮЧИТЬ ПОДКЛЮЧЕНИЕ ПО ПАРОЛЮ

1. 
```zsh
vim /etc/ssh/sshd_config
```
2. 
```vim
PasswordAuthentication yes -> no
PermitRootLogin yes -> no
AllowUsers <user_name> root # root можно оставить, так как выше уже его заноутили
```
3. 
```zsh
sudo service ssh restart
```

### SSH-AGENT

При работе с ключами возможны две неудобные ситуации:

1. Если при создании ключа вы указали `passphrase (пароль для ключа)`, то вам придется вводить пароль при каждом подключении.
2. Если у вас есть несколько ключей для разных целей, то при соединении по `ssh` придется указывать нужный ключ вручную.

`ssh-agent` решает эти проблемы. Если добавить ключ к агенту, то:

1. Для него больше не будет спрашиваться `passphrase`.
2. Не нужно будет вводить ключ вручную — он будет автоматически использован при соответствующем подключении.

Работает на фоне в \*nix-системах. В некоторых других системах приходится устанавливать и настраивать его автозапуск самостоятельно.
```zsh
eval '$(ssh-agent -s)'
```

```zsh
ssh-add ~/.ssh/id_rsa
```
Если не указать путь до приватного ключа, то добавятся:
	+ ~/.ssh/id_rsa
	+ ~/.ssh/id_dsa
	+ ~/.ssh/id_ecdsa
	+ ~/.ssh/id_ed25519
	+ ~/.ssh/identity

Чтобы вывести список добавленных в агент ключей:
```zsh
ssh-add -L
```

Чтобы удалить из агента определенный и все ключи соответсвенно:
```zsh
ssh-add -d ~/.ssh/id_rsa
ssh-add -D
```

> **Warning**
> ssh-agent привязан к сессии.

### ФОРВАРДИНГ (ПРОБРОС) АВТОРИЗАЦИИ

```zsh
ssh -A <user_name_1>@<remote_host_1> ssh <user_name_2>@<remote_host_2>
```

### SSH АЛИАСЫ

```
man ssh_config
```

1. 
```zsh
vim ~/.ssh/config
```
2. 
```text
Host <host_name>
Hostname <remote_host>
User <user_name>
Port <port>
```
3. 
```zsh
ssh <host_name>
```

### extra links

- [Что такое протокол SSH | Hexlet](https://guides.hexlet.io/ru/ssh)
- [Памятка пользователям ssh](https://habr.com/ru/post/122445/)